<div class="result-wrapper">
  <div class="result-card">
    
    <!-- 🎉 Completion Message -->
    <div class="congrats-popup" *ngIf="score === total">
      <h2>🎉 Challenge Completed! - {{ username }}'s Report!!</h2>
      <p>You unlocked Level {{ level + 1 }}!</p>
    </div>

    <!-- 🔁 Try Again Message -->
    <div *ngIf="score < total" class="try-again-msg">
      🔁 You scored {{ score }} out of {{ total }}. Keep practicing and try again!
    </div>

    <!-- ⭐ Summary Section -->
    <div class="result-summary-container">
      <div class="summary-card">
        <h3>⭐ Score Summary</h3>

        <div class="summary-row green">
          <div class="summary-value">{{ score }}</div>
          <div class="summary-label">Score</div>
        </div>
        <hr />

        <div class="summary-row orange">
          <div class="summary-value">{{ attemptedCount }}</div>
          <div class="summary-label">Attempted</div>
        </div>
        <hr />

        <div class="summary-row blue">
          <div class="summary-value">{{ timeTaken || '0m 0s' }}</div>
          <div class="summary-label">Time Taken</div>
        </div>
        <hr />

        <div class="summary-row violet">
          <div class="summary-value">{{ (score / total * 100) | number:'1.0-0' }}%</div>
          <div class="summary-label">Accuracy</div>
        </div>
      </div>

      <!-- 📈 Progress Graph -->
      <div class="graph-card" >
        <canvas baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          [type]="lineChartType">
        </canvas>
      </div>
    </div>

    <!-- 📊 Progress Bar -->
    <div class="progress-container">
      <label>Accuracy:</label>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="(score / total) * 100"></div>
      </div>
    </div>

    <!-- 🧑‍🏫 Action Buttons -->
    <div class="result-buttons">
      <button (click)="reviewQuiz()">🔍 Review Quiz</button>
      <button *ngIf="score < total" (click)="retrySameLevel()">🔁 Try Again</button>
      <button *ngIf="score === total" (click)="goToNextLevel()">🚀 Go to Next Level</button>
      <button (click)="goToOperations()">📚 Choose Module</button>
    </div>

    <!-- ✅ Review Answer List -->
    <div class="answer-review-list">
      <div class="answer-card" *ngFor="let q of questions; let i = index">
        <div class="question-number">{{ i + 1 }}. Question</div>
        <div class="question-text">{{ q.question }}?</div>

        <div class="user-answer">
          <strong>{{ username }} Answered:</strong>
          <span [ngClass]="{ correct: q.userAnswer == q.correctValue, incorrect: q.userAnswer != q.correctValue }">
            {{ q.userAnswer || 'No answer provided' }}
            <span *ngIf="q.userAnswer == q.correctValue">✅</span>
            <span *ngIf="q.userAnswer != q.correctValue">❌</span>
          </span>
        </div>

        <div class="correct-answer"><strong>Correct Answer:</strong> {{ q.correctValue }}</div>
        <div class="explanation"><strong>Explanation:</strong> {{ q.explanation || 'No explanation provided.' }}</div>
      </div>
    </div>

  </div>
</div>
